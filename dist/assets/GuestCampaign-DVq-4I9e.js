import{r as u,j as s,B as w,_ as i,P as C,Q as v,v as A,C as S,T as b}from"./index-BYm0heM1.js";import{A as y,a as _,b as I,c as N,e as D}from"./alert-dialog-DGbS2dWL.js";import{I as L}from"./input-BAm2WIgo.js";import{C as g}from"./Card-BVtWluvH.js";import{C as T}from"./CampaignTable-BgHdyudV.js";import"./index-CK6rgK6y.js";import"./Combination-gmHXTl4U.js";import"./table-CH7Ta2XO.js";import"./index-Ctl9Yn3d.js";function V({modalActive:x,setModalActive:n,setCampaigns:f,campaign_id:c}){const[e,d]=u.useState(!1),h=async l=>{d(!0),l.preventDefault();const j=l.target,r=Object.fromEntries(new FormData(j)).access_code,o=i.loading("Verifying access code...");await C.get(`${v}/dashboard/${c}/${r}`).then(t=>{i.success("Access code verified",{id:o}),f(t.data),sessionStorage.setItem("guestVerified","true"),sessionStorage.setItem("access_code",JSON.stringify(r)),n(!1)}).catch(t=>{if(t.response.status&&t.response.status===401)return i.error("Access denied. Access code invalid",{id:o});i.error("Something went wrong",{id:o}),console.log(t)}).finally(()=>d(!1))};return s.jsx(y,{open:x,children:s.jsxs(_,{className:"max-w-lg",children:[s.jsx(I,{children:s.jsx(N,{className:"text-xl font-semibold",children:"Enter Access Code"})}),s.jsx(D,{children:"An access code was sent with the invite mail. Enter it to gain access to view this campaign"}),s.jsxs("form",{onSubmit:h,className:"flex items-center gap-2",children:[s.jsx(L,{type:"text",placeholder:"access code",name:"access_code",required:!0}),s.jsx(w,{type:"submit",className:"pry-btn",disabled:e,children:"View Campaign"})]})]})})}function M(){var p;const x=sessionStorage.getItem("guestVerified"),{campaign_id:n}=A(),[f,c]=u.useState(()=>!x),[e,d]=u.useState([]),[h,l]=u.useState(!1),j=async()=>{l(!0);const a=sessionStorage.getItem("access_code");if(!a)return c(!0);await C.get(`${v}/dashboard/${n}/${JSON.parse(a)}`).then(m=>{d(m.data),sessionStorage.setItem("guestVerified","true")}).catch(m=>{if(c(!0),m.response.status&&m.response.status===401)return i.error("Access denied. Access code invalid");i.error("Something went wrong")}).finally(()=>{l(!1)})};u.useEffect(()=>{sessionStorage.getItem("guestVerified")&&j()},[]);const r=(e==null?void 0:e.leads)&&(e==null?void 0:e.leads.filter(a=>a.status.toLowerCase()==="contacted")),o=(e==null?void 0:e.leads)&&(e==null?void 0:e.leads.filter(a=>a.contacted_status.toLowerCase()==="converted")),t=(e==null?void 0:e.leads)&&(e==null?void 0:e.leads.filter(a=>a.contacted_status.toLowerCase()==="rejected"));return s.jsxs(s.Fragment,{children:[f&&s.jsx(V,{modalActive:f,setModalActive:c,setCampaigns:d,campaign_id:n}),s.jsxs("div",{className:"px-[4vw] pb-10",children:[s.jsx(S,{}),h?s.jsx(b,{}):(e==null?void 0:e.leads)&&s.jsxs("div",{className:"mt-10",children:[s.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[s.jsx(g,{title:"Total Leads",qty:((p=e==null?void 0:e.leads)==null?void 0:p.length)||0}),s.jsx(g,{title:"Total Called",qty:(r==null?void 0:r.length)||0}),s.jsx(g,{title:"Total Qualified",qty:(o==null?void 0:o.length)||0}),s.jsx(g,{title:"Total Rejected",qty:(t==null?void 0:t.length)||0})]}),s.jsx("div",{className:"p-4 rounded-2xl bg-white",children:s.jsx(T,{guest:!0,campaign_id:n??"",data:e==null?void 0:e.leads,campaign_name:e==null?void 0:e.campaign_name})})]})]})]})}export{M as default};

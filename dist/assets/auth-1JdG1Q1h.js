import{_ as s,V as r,W as i}from"./index-By6uAPBI.js";const d=async(o,t,n)=>{const a=s.loading("Creating your account");t(!0),await r.post(`${i}/api/register/`,o).then(e=>{localStorage.getItem("newUser")&&localStorage.removeItem("newUser"),localStorage.setItem("newUser",JSON.stringify(e.data)),s.success("Account creation successful",{id:a}),n("/auth/verify-otp")}).catch(e=>{e.response.data.email?s.error(`Account creation failed. ${e.response.data.email[0]}`,{id:a}):e.response.data.phone_number?s.error(`Account creation failed. ${e.response.data.phone_number[0]}`,{id:a}):e.response.data.last_name?s.error("Account creation failed. Please enter a full name",{id:a}):s.error("Something went wrong. Please retry",{id:a}),console.log(e)}).finally(()=>{t(!1)})},u=async(o,t,n)=>{t(!0);const a=s.loading("Signing In...");await r.post(`${i}/api/token/`,o).then(e=>{const c={access:e.data.access,refresh:e.data.refresh};localStorage.setItem("tokens",JSON.stringify(c)),localStorage.setItem("user",JSON.stringify(e.data.user.id)),localStorage.setItem("business_id",JSON.stringify(e.data.user.businesses[0].id)),s.success("Login Successful",{id:a}),n("/app/dashboard")}).catch(e=>{e.response.data.non_field_errors?s.error(`Sign in failed. ${e.response.data.non_field_errors[0]}`,{id:a}):s.error("Something went wrong. Please retry",{id:a})}).finally(()=>{t(!1)})},f=async(o,t)=>{const n=s.loading("Verifying OTP...");await r({url:`${i}/api/activate/`,method:"post",data:o}).then(()=>{s.success("OTP verification successful. Please Sign in",{id:n}),localStorage.removeItem("newUser"),t("/auth")}).catch(a=>{s.error("Please check the OTP and retry",{id:n}),console.log(a)})},g=async o=>{const t=s.loading("Resend OTP",{id:"resendotp"});await r.post(`${i}/auth/user/resend_activation`,{email:o}).then(()=>{s.success("OTP resent to your email",{id:t})}).catch(()=>{s.error("Cannot resend otp",{id:t})})};export{f as O,g as a,u as l,d as r};
